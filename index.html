<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>NEW PROUD NAILS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="NEW PROUD NAILS - ‰∏ì‰∏öÁæéÁî≤ÊúçÂä°Ôºå‰ΩìÈ™å‰ºòÈõÖ‰∏éÁæé‰∏Ω">
<meta name="theme-color" content="#667eea">
<script src="config-sound.js"></script>
<style>
* {
  user-select: none;
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  background-image: 
    linear-gradient(135deg, rgba(102, 126, 234, 0.4) 0%, rgba(118, 75, 162, 0.4) 100%),
    url('glass-bg.jpg');
  background-size: 110% 110%, cover;
  background-position: center center, center center;
  background-attachment: scroll, fixed;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  transition: background-position 0.1s ease-out;
}

.language-switcher {
  position: absolute;
  bottom: calc(14% + 200px);
  width: 100%;
  display: flex;
  justify-content: center;
  gap: 15px;
  z-index: 998;
  padding: 0 20px;
}

.lang-btn {
  min-width: 90px;
  height: 45px;
  background: rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(20px);
  border: 2px solid rgba(255, 255, 255, 0.45);
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  color: rgba(255, 255, 255, 0.95);
  font-size: 15px;
  font-weight: 700;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  cursor: pointer;
  transition: all 0.3s ease;
}

.lang-btn:hover {
  background: rgba(255, 255, 255, 0.35);
  transform: translateY(-3px);
}

.lang-btn.active {
  background: rgba(255, 255, 255, 0.5);
  border-color: rgba(255, 255, 255, 0.7);
  transform: translateY(-2px);
}

#logo {
  position: absolute;
  top: 96px;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  text-align: center;
  font-size: clamp(96px, 10vw, 128px);
  font-weight: 800;
  letter-spacing: 3px;
  background: #FF5B5F;
  background-size: cover;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: 
    2px 2px 0px rgba(255, 255, 255, 0.4),
    3px 3px 0px rgba(255, 255, 255, 0.3);
  z-index: 2;
  cursor: pointer;
  filter: brightness(1.1) contrast(1.1);
}

/* UÂ≠óÊØç‰Ωú‰∏∫Êî∂ÈõÜÂÆπÂô® - Êó†ÈáëÂÖâ */
.letter-u {
  position: relative;
  display: inline-block;
  color: #FFD700;
  -webkit-text-fill-color: #FFD700;
  font-weight: 900;
  transition: all 0.5s ease;
}

.letter-u.tilting {
  animation: tiltU 1s ease-out forwards;
}

@keyframes tiltU {
  0% { transform: rotate(0deg); }
  50% { transform: rotate(45deg) translateY(20px); }
  100% { transform: rotate(90deg) translateY(40px) translateX(100px); }
}

.score-display {
  position: fixed;
  top: 30px;
  right: 30px;
  background: rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(15px);
  padding: 15px 25px;
  border-radius: 15px;
  border: 2px solid rgba(255, 255, 255, 0.5);
  z-index: 999;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
}

.music-toggle {
  position: absolute;
  top: 8px;
  left: 8px;
  width: 36px;
  height: 36px;
  border: none;
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: all 0.3s ease;
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.music-toggle:hover {
  background: rgba(255, 255, 255, 0.4);
  transform: scale(1.1);
}

.music-toggle.muted {
  background: rgba(255, 59, 63, 0.3);
  border-color: rgba(255, 59, 63, 0.5);
}

.score-label {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 600;
  margin-bottom: 5px;
  margin-top: 5px;
}

.score-value {
  font-size: 32px;
  font-weight: 800;
  color: #fff;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.ball-count {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.8);
  font-weight: 600;
  margin-top: 2px;
}

/* È¢ÑÁ∫¶Èù¢ÊùøÊ†áÈ¢òÊ†èÊó∂Èíü - Âä†Â§ßÂ≠ó‰Ωì */
.panel-title-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex: 1;
  margin-right: 20px;
}

.panel-title-text {
  font-size: 38px;
  font-weight: 900;
  color: rgba(255, 255, 255, 0.98);
  text-shadow: 0 2px 0 rgba(0, 0, 0, 0.25), 0 5px 12px rgba(0, 0, 0, 0.4);
  letter-spacing: 2px;
}

.panel-title-clock {
  font-size: 18px;
  font-weight: 700;
  color: rgba(255, 255, 255, 0.95);
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  font-family: 'Courier New', monospace;
  letter-spacing: 1px;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

.panel-clock-time-inline {
  font-size: 24px;
  margin-bottom: 4px;
  font-weight: 800;
}

.panel-clock-date-inline {
  font-size: 16px;
  opacity: 0.95;
  font-weight: 600;
}

.light-dot {
  position: absolute;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 3px solid rgba(255, 255, 255, 0.95);
  box-shadow: 0 0 40px rgba(255, 255, 255, 0.95), 0 0 120px rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(4px);
  cursor: pointer;
  z-index: 3;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  top: -100px;
  transition: opacity 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.light-dot.visible { opacity: 1; }
.light-dot.scared { animation: shake 0.3s ease; }

@keyframes shake {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(-10deg) scale(0.95); }
  75% { transform: rotate(10deg) scale(0.95); }
}

.face {
  position: relative;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.25);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.eyes {
  display: flex;
  justify-content: space-between;
  width: 100%;
  margin-bottom: 2px;
}

.eye {
  position: relative;
  width: 26px;
  height: 34px;
}

.eye-white {
  width: 100%;
  height: 100%;
  background: #fff;
  border-radius: 50% / 60%;
  border: 1px solid rgba(0, 0, 0, 0.2);
  transition: all 0.2s ease;
}

.pupil {
  width: 12px;
  height: 12px;
  background: #000;
  border-radius: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  transition: all 0.1s ease;
}

.eye.scared .eye-white {
  width: 120%;
  height: 120%;
  margin-left: -10%;
  margin-top: -10%;
}

.eye.scared .pupil {
  width: 8px;
  height: 8px;
}

.eye.closed .eye-white {
  height: 2px;
  border-radius: 2px;
}

.mouth {
  width: 12px;
  height: 6px;
  border-bottom: 2px solid #000;
  border-radius: 0 0 6px 6px;
  transition: all 0.2s ease;
}

.mouth.scared {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 2px solid #000;
}

.speech-bubble {
  position: absolute;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 20px;
  padding: 12px 20px;
  font-size: 18px;
  font-weight: 600;
  color: #FF3B3F;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
  z-index: 4;
  opacity: 0;
  transition: opacity 0.5s ease, transform 0.5s ease;
  pointer-events: none;
  transform: translateX(-50%) translateY(-10px);
}

.speech-bubble.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

.speech-bubble::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-top: 10px solid rgba(255, 255, 255, 0.95);
}

#buttons {
  position: absolute;
  bottom: 14%;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  display: flex;
  justify-content: center;
  gap: 20px;
  z-index: 2;
  flex-wrap: wrap;
  padding: 0 20px;
}

.glass-btn {
  min-width: 140px;
  height: 60px;
  border-radius: 18px;
  background: rgba(255, 255, 255, 0.28);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.65);
  box-shadow: 0 18px 36px rgba(0, 0, 0, 0.18), inset 0 1px 0 rgba(255, 255, 255, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 16px;
  color: #fff;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.35);
  cursor: pointer;
  transition: transform 0.12s ease, box-shadow 0.12s ease;
  position: relative;
  overflow: hidden;
  padding: 0 15px;
}

.glass-btn:active {
  transform: translateY(2px) scale(0.97);
}

.glass-btn.satisfied {
  animation: giftPulse 0.5s ease-in-out 3;
}

@keyframes giftPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

.glass-ball {
  position: absolute;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9), rgba(200, 200, 255, 0.4));
  backdrop-filter: blur(8px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3), inset -2px -2px 8px rgba(0, 0, 0, 0.2);
  z-index: 5;
  border: 2px solid rgba(255, 255, 255, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 800;
  transition: transform 0.3s ease;
}

.glass-ball.gold {
  background: radial-gradient(circle at 30% 30%, #FFD700, #FFA500);
  box-shadow: 0 8px 24px rgba(255, 215, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.4);
  animation: goldGlow 1s ease infinite;
}

@keyframes goldGlow {
  0%, 100% { box-shadow: 0 8px 24px rgba(255, 215, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.4); }
  50% { box-shadow: 0 8px 24px rgba(255, 215, 0, 0.9), 0 0 40px rgba(255, 215, 0, 0.7); }
}

.glass-ball.silver {
  background: radial-gradient(circle at 30% 30%, #E8E8E8, #C0C0C0);
  box-shadow: 0 8px 24px rgba(192, 192, 192, 0.6), 0 0 20px rgba(192, 192, 192, 0.4);
  animation: silverShine 1.5s ease infinite;
}

@keyframes silverShine {
  0%, 100% { box-shadow: 0 8px 24px rgba(192, 192, 192, 0.6), 0 0 20px rgba(192, 192, 192, 0.4); }
  50% { box-shadow: 0 8px 24px rgba(192, 192, 192, 0.8), 0 0 30px rgba(192, 192, 192, 0.6); }
}

.glass-ball.normal {
  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9), rgba(200, 200, 255, 0.4));
}

#promoCard {
  position: absolute;
  width: 90%;
  max-width: 400px;
  height: 250px;
  border-radius: 24px;
  background: linear-gradient(135deg, #FF3B3F, #FF6B6F);
  box-shadow: 0 24px 48px rgba(0, 0, 0, 0.4);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: #fff;
  cursor: pointer;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  opacity: 0;
  transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.8s ease;
  z-index: 10;
  text-align: center;
  padding: 20px;
}

#promoCard.show {
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
}

.promo-text {
  font-size: 32px;
  margin-bottom: 10px;
}

.promo-subtitle {
  font-size: 18px;
  opacity: 0.9;
}

#fireworkCanvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9;
  pointer-events: none;
}

.panel-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(6px);
  z-index: 998;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.8s ease, visibility 0.8s ease;
}

.panel-overlay.show {
  opacity: 1;
  visibility: visible;
}

.function-detail-panel {
  position: fixed;
  top: 0;
  left: -100%;
  width: 85%;
  max-width: 600px;
  height: 100%;
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(100px) saturate(300%) brightness(1.15) contrast(1.1);
  border-right: 8px solid rgba(255, 255, 255, 0.7);
  box-shadow: 
    16px 0 120px rgba(0, 0, 0, 0.7),
    12px 0 80px rgba(0, 0, 0, 0.5);
  z-index: 999;
  transition: left 1.5s cubic-bezier(0.16, 0.84, 0.44, 1);
  overflow-y: auto;
}

.function-detail-panel.show {
  left: 0;
}

.panel-header {
  position: sticky;
  top: 0;
  background: rgba(255, 255, 255, 0.35);
  backdrop-filter: blur(25px);
  padding: 30px;
  border-bottom: 3px solid rgba(255, 255, 255, 0.5);
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 10;
}

.panel-title {
  font-size: 38px;
  font-weight: 900;
  color: rgba(255, 255, 255, 0.98);
  text-shadow: 0 2px 0 rgba(0, 0, 0, 0.25), 0 5px 12px rgba(0, 0, 0, 0.4);
  letter-spacing: 2px;
}

.panel-close-btn {
  width: 54px;
  height: 54px;
  background: rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(12px);
  border: 3px solid rgba(255, 255, 255, 0.6);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 32px;
  color: rgba(255, 255, 255, 0.95);
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

.panel-close-btn:hover {
  background: rgba(255, 255, 255, 0.5);
  transform: scale(1.15) rotate(90deg);
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.35);
}

.panel-content {
  padding: 40px 30px;
  min-height: calc(100% - 130px);
}

.content-section {
  background: rgba(255, 255, 255, 0.18);
  backdrop-filter: blur(18px);
  border-radius: 22px;
  padding: 32px;
  margin-bottom: 28px;
  border: 2px solid rgba(255, 255, 255, 0.35);
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
}

.section-title {
  font-size: 26px;
  font-weight: 800;
  color: rgba(255, 255, 255, 0.98);
  margin-bottom: 18px;
  text-shadow: 0 2px 5px rgba(0, 0, 0, 0.35);
}

.section-text {
  font-size: 17px;
  line-height: 1.9;
  color: rgba(255, 255, 255, 0.92);
  text-shadow: 0 1px 4px rgba(0, 0, 0, 0.35);
}

.feature-list {
  list-style: none;
  padding: 0;
  margin: 22px 0;
}

.feature-item {
  background: rgba(255, 255, 255, 0.25);
  padding: 17px 22px;
  margin-bottom: 14px;
  border-radius: 14px;
  border-left: 5px solid rgba(255, 255, 255, 0.7);
  color: rgba(255, 255, 255, 0.98);
  font-size: 17px;
  text-shadow: 0 1px 4px rgba(0, 0, 0, 0.35);
  transition: all 0.3s ease;
}

.feature-item:hover {
  background: rgba(255, 255, 255, 0.35);
  transform: translateX(12px);
}

.action-button {
  width: 100%;
  padding: 20px;
  background: rgba(255, 255, 255, 0.35);
  backdrop-filter: blur(12px);
  border: 3px solid rgba(255, 255, 255, 0.7);
  border-radius: 16px;
  color: rgba(255, 255, 255, 0.98);
  font-size: 19px;
  font-weight: 800;
  text-shadow: 0 2px 5px rgba(0, 0, 0, 0.35);
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 24px;
}

.action-button:hover {
  background: rgba(255, 255, 255, 0.5);
  transform: translateY(-4px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
}

@media (max-width: 400px) and (max-height: 700px) {
  #logo {
    top: 60px;
    font-size: clamp(70px, 10vw, 90px);
  }
  
  .glass-btn {
    min-width: 110px;
    height: 50px;
    font-size: 14px;
  }
  
  .lang-btn {
    min-width: 70px;
    height: 38px;
    font-size: 13px;
  }
  
  .language-switcher {
    gap: 8px;
    bottom: calc(14% + 70px);
  }
  
  #buttons {
    gap: 12px;
  }
  
  .score-display {
    top: 15px;
    right: 15px;
    padding: 10px 15px;
  }
  
  .score-value {
    font-size: 24px;
  }
}
</style>
</head>
<body>

<div class="panel-overlay" id="panelOverlay" onclick="closeFunctionPanel()"></div>

<div class="function-detail-panel" id="functionPanel">
  <div class="panel-header">
    <div class="panel-title" id="panelTitle">È¢ÑÁ∫¶</div>
    <div class="panel-close-btn" onclick="closeFunctionPanel()">√ó</div>
  </div>
  <div class="panel-content" id="panelContentArea"></div>
</div>

<div class="score-display">
  <button class="music-toggle" id="musicToggle" onclick="toggleMusic()" title="Èü≥‰πêÂºÄÂÖ≥">
    <span id="musicIcon">üîä</span>
  </button>
  <div class="score-label">Score</div>
  <div class="score-value" id="scoreValue">0</div>
  <div class="ball-count" id="ballCount">(0/20)</div>
</div>

<div id="logo" onclick="playLogoSound()">NEW PRO<span class="letter-u" id="letterU">U</span>D NAILS</div>

<div class="light-dot">
  <div class="face">
    <div class="eyes">
      <div class="eye"><div class="eye-white"></div><div class="pupil"></div></div>
      <div class="eye"><div class="eye-white"></div><div class="pupil"></div></div>
    </div>
    <div class="mouth"></div>
  </div>
</div>

<div class="speech-bubble">ÂìàÂñΩÔºÅ</div>

<div class="language-switcher">
  <button class="lang-btn active" data-lang="zh" onclick="switchLanguage('zh')">‰∏≠Êñá</button>
  <button class="lang-btn" data-lang="en" onclick="switchLanguage('en')">English</button>
  <button class="lang-btn" data-lang="es" onclick="switchLanguage('es')">Espa√±ol</button>
</div>

<div id="buttons">
  <div class="glass-btn" onclick="clickButton('book')"><span id="btnBook">È¢ÑÁ∫¶</span></div>
  <div class="glass-btn" id="giftBtn">
    <span><span id="btnGiftFull">GIFT</span><span id="ballCount2"></span></span>
  </div>
  <div class="glass-btn" onclick="clickButton('services')"><span id="btnServices">ÊúçÂä°</span></div>
  <div class="glass-btn" onclick="clickButton('member')"><span id="btnMember">‰ºöÂëò</span></div>
</div>

<div id="promoCard">
  <div class="promo-text">üéÅ ÊÅ≠ÂñúÔºÅ</div>
  <div class="promo-subtitle">ÊÇ®Ëé∑Âæó‰∫Ü‰∏ìÂ±û‰ºòÊÉ†</div>
</div>

<canvas id="fireworkCanvas"></canvas>

<script>
// ========== ÂÖ®Â±ÄÂèòÈáè ==========
let currentScore = 0;
let totalBalls = 0;
const TARGET_SCORE = 20;
let tiltX = 0;
let tiltY = 0;
let currentLanguage = 'zh';
let ballsInU = [];

// ========== Èü≥ÊïàÁÆ°ÁêÜÁ≥ªÁªüÔºàÂÆåÊï¥ÁâàÔºâ ==========
const AudioManager = {
  bgm: null,
  sounds: {},
  voices: {},
  
  init: function() {
    if (typeof ASSETS === 'undefined') {
      console.warn('config-sound.jsÊú™Âä†ËΩΩÔºåÈü≥ÊïàÁ≥ªÁªüÊú™ÂàùÂßãÂåñ');
      return;
    }
    
    // ÂàùÂßãÂåñËÉåÊôØÈü≥‰πê
    if (ASSETS.sounds && ASSETS.sounds.bgm) {
      this.bgm = new Audio(ASSETS.sounds.bgm);
      this.bgm.loop = true;
      this.bgm.volume = ASSETS.audioSettings.bgmVolume;
    }
    
    // ÂàùÂßãÂåñÈü≥Êïà
    if (ASSETS.sounds) {
      Object.keys(ASSETS.sounds).forEach(key => {
        if (key !== 'bgm' && ASSETS.sounds[key]) {
          this.sounds[key] = new Audio(ASSETS.sounds[key]);
          this.sounds[key].volume = ASSETS.audioSettings.effectVolume;
        }
      });
    }
    
    // Âä†ËΩΩÂΩìÂâçËØ≠Ë®ÄÁöÑËØ≠Èü≥
    this.loadVoices(currentLanguage);
  },
  
  loadVoices: function(lang) {
    if (typeof ASSETS === 'undefined' || !ASSETS.languages || !ASSETS.languages[lang]) {
      return;
    }
    
    const voices = ASSETS.languages[lang].voice;
    if (voices) {
      Object.keys(voices).forEach(key => {
        this.voices[key] = new Audio(voices[key]);
        this.voices[key].volume = ASSETS.audioSettings.voiceVolume;
      });
    }
  },
  
  playBGM: function() {
    if (this.bgm && typeof ASSETS !== 'undefined' && ASSETS.audioSettings && ASSETS.audioSettings.enableBGM) {
      this.bgm.play().catch(e => console.log('BGMÊí≠ÊîæÈúÄË¶ÅÁî®Êà∑‰∫§‰∫í'));
    }
  },
  
  stopBGM: function() {
    if (this.bgm) {
      this.bgm.pause();
      this.bgm.currentTime = 0;
    }
  },
  
  stopAllAudio: function() {
    if (this.bgm) {
      this.bgm.pause();
      this.bgm.currentTime = 0;
    }
    Object.values(this.sounds).forEach(sound => {
      if (sound) {
        sound.pause();
        sound.currentTime = 0;
      }
    });
    Object.values(this.voices).forEach(voice => {
      if (voice) {
        voice.pause();
        voice.currentTime = 0;
      }
    });
  },
  
  playSound: function(soundName) {
    if (this.sounds[soundName] && typeof ASSETS !== 'undefined' && ASSETS.audioSettings && ASSETS.audioSettings.enableEffects) {
      this.sounds[soundName].currentTime = 0;
      this.sounds[soundName].play().catch(e => console.log('Èü≥ÊïàÊí≠ÊîæÂ§±Ë¥•'));
    }
  },
  
  playVoice: function(voiceName) {
    if (this.voices[voiceName] && typeof ASSETS !== 'undefined' && ASSETS.audioSettings && ASSETS.audioSettings.enableVoice) {
      this.voices[voiceName].currentTime = 0;
      this.voices[voiceName].play().catch(e => console.log('ËØ≠Èü≥Êí≠ÊîæÂ§±Ë¥•'));
    }
  }
};

// ========== DOMÂÖÉÁ¥† ==========
const dot = document.querySelector(".light-dot");
const eyes = dot.querySelectorAll(".eye");
const mouth = document.querySelector(".mouth");
const speechBubble = document.querySelector(".speech-bubble");
const giftBtn = document.getElementById("giftBtn");
const letterU = document.getElementById("letterU");
const ballCountDisplay = document.getElementById("ballCount");
const scoreDisplay = document.getElementById("scoreValue");
const promoCard = document.getElementById("promoCard");
const canvas = document.getElementById("fireworkCanvas");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;

const centerX = innerWidth / 2;
const centerY = innerHeight / 2;
const groundY = innerHeight - 150;

let walkTimer, mouseX = centerX, mouseY = centerY;
let clickCount = 0, isScared = false;
let balls = [];

// ÂàùÂßã‰ΩçÁΩÆÂú®‰∏äÊñπ
dot.style.left = `${centerX - 30}px`;
dot.style.top = `-100px`;

// ========== Ëß¶Â±èÂêØÂä®Á≥ªÁªü ==========
window.addEventListener('load', () => {
  let hasStarted = false;
  
  function startEverything() {
    if (hasStarted) return;
    hasStarted = true;
    
    // ÂàùÂßãÂåñÈü≥ÊïàÁ≥ªÁªü
    AudioManager.init();
    
    // ÂºÄÂêØËÉåÊôØÈü≥‰πê
    AudioManager.playBGM();
    
    // Á≤æÁÅµ‰ªé‰∏äÊñπÈ£òËêΩ
    dot.style.transition = 'top 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)';
    dot.style.top = `${centerY - 30}px`;
    dot.classList.add('visible');
    
    AudioManager.playSound('spriteAppear');
    
    setTimeout(() => {
      let greetingText = 'ÂìàÂñΩÔºÅ';
      if (typeof ASSETS !== 'undefined' && ASSETS.languages && ASSETS.languages[currentLanguage]) {
        greetingText = ASSETS.languages[currentLanguage].greeting;
      }
      
      showSpeechBubble(greetingText, 3000);
      AudioManager.playVoice('greeting');
      
      startRandomWalk();
      blinkEyes();
    }, 1500);
  }
  
  // Á≠âÂæÖÁî®Êà∑Ëß¶Â±è/ÁÇπÂáª
  document.addEventListener('click', startEverything, { once: true });
  document.addEventListener('touchstart', startEverything, { once: true });
  
  // ÈôÄËû∫‰ª™
  if (window.DeviceOrientationEvent) {
    window.addEventListener('deviceorientation', (e) => {
      if (e.gamma !== null && e.beta !== null) {
        tiltX = e.gamma / 90;
        tiltY = (e.beta - 45) / 90;
      }
    });
  }
});

function showSpeechBubble(text, duration = 3000) {
  const dotRect = dot.getBoundingClientRect();
  speechBubble.textContent = text;
  speechBubble.style.left = `${dotRect.left + dotRect.width / 2}px`;
  speechBubble.style.top = `${dotRect.top - 50}px`;
  speechBubble.classList.add('show');
  setTimeout(() => speechBubble.classList.remove('show'), duration);
}

function updatePupils() {
  eyes.forEach(eye => {
    const pupil = eye.querySelector(".pupil");
    const rect = eye.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;
    const dx = mouseX - cx;
    const dy = mouseY - cy;
    const max = 10;
    pupil.style.left = 50 + Math.max(-max, Math.min(dx / 10, max)) + "%";
    pupil.style.top = 50 + Math.max(-max, Math.min(dy / 10, max)) + "%";
  });
}

document.addEventListener("mousemove", e => {
  mouseX = e.clientX;
  mouseY = e.clientY;
  updatePupils();
});

document.addEventListener("touchmove", e => {
  if (e.touches.length > 0) {
    mouseX = e.touches[0].clientX;
    mouseY = e.touches[0].clientY;
    updatePupils();
  }
}, { passive: true });

function blinkEyes() {
  eyes.forEach(eye => eye.classList.add("closed"));
  setTimeout(() => eyes.forEach(eye => eye.classList.remove("closed")), 100);
  setTimeout(() => blinkEyes(), 2000 + Math.random() * 3000);
}

function showScaredFace() {
  isScared = true;
  eyes.forEach(eye => eye.classList.add("scared"));
  mouth.classList.add("scared");
  dot.classList.add("scared");
  
  setTimeout(() => {
    eyes.forEach(eye => eye.classList.remove("scared"));
    mouth.classList.remove("scared");
    dot.classList.remove("scared");
    isScared = false;
  }, 800);
}

function startRandomWalk() {
  walkTimer = setInterval(() => {
    if (isScared) return;
    
    let x, y;
    const leaveScreen = Math.random() < 0.2;
    
    if (leaveScreen) {
      const side = Math.floor(Math.random() * 4);
      switch(side) {
        case 0: x = -100; y = Math.random() * innerHeight; break;
        case 1: x = innerWidth + 100; y = Math.random() * innerHeight; break;
        case 2: x = Math.random() * innerWidth; y = -100; break;
        case 3: x = Math.random() * innerWidth; y = innerHeight + 100; break;
      }
      
      dot.style.transition = 'left 2s ease-out, top 2s ease-out';
      dot.style.left = `${x}px`;
      dot.style.top = `${y}px`;
      
      setTimeout(() => {
        const returnX = Math.random() * (innerWidth - 60);
        const returnY = Math.random() * (innerHeight - 200) + 100;
        dot.style.left = `${returnX}px`;
        dot.style.top = `${returnY}px`;
      }, 2500);
    } else {
      x = Math.random() * (innerWidth - 60);
      y = Math.random() * (innerHeight - 200) + 100;
      
      const dx = x - mouseX;
      const dy = y - mouseY;
      const dist = Math.hypot(dx, dy);
      if (dist < 150) {
        x += dx / dist * 100;
        y += dy / dist * 100;
        x = Math.max(0, Math.min(innerWidth - 60, x));
        y = Math.max(0, Math.min(innerHeight - 200, y));
      }
      
      dot.style.transition = 'left 2s ease-out, top 2s ease-out';
      dot.style.left = `${x}px`;
      dot.style.top = `${y}px`;
    }
  }, 3000);
}

function handleDotClick(e) {
  e.preventDefault();
  e.stopPropagation();
  clickCount++;
  
  if (clickCount === 1) {
    showScaredFace();
    AudioManager.playSound('spriteEscape');
    
    const currentX = parseFloat(dot.style.left);
    const currentY = parseFloat(dot.style.top);
    const angle = Math.random() * Math.PI * 2;
    const distance = 150;
    const escapeX = currentX + Math.cos(angle) * distance;
    const escapeY = currentY + Math.sin(angle) * distance;
    
    dot.style.transition = 'left 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)';
    dot.style.left = `${Math.max(0, Math.min(innerWidth - 60, escapeX))}px`;
    dot.style.top = `${Math.max(0, Math.min(innerHeight - 200, escapeY))}px`;
    
    setTimeout(() => {
      dot.style.transition = 'left 2s ease-out, top 2s ease-out';
    }, 300);
  } else if (clickCount === 2) {
    showScaredFace();
    AudioManager.playSound('spriteHit');
    dropBall();
    clickCount = 0;
  }
}

dot.addEventListener("touchstart", handleDotClick, { passive: false });
dot.addEventListener("click", handleDotClick);

function dropBall() {
  const rect = dot.getBoundingClientRect();
  const ball = document.createElement("div");
  ball.className = "glass-ball";
  
  const random = Math.random() * 100;
  let ballType, ballScore;
  
  if (random < 5) {
    ballType = 'gold';
    ballScore = 3;
    ball.textContent = '‚≠ê';
  } else if (random < 30) {
    ballType = 'silver';
    ballScore = 2;
    ball.textContent = '‚ú®';
  } else {
    ballType = 'normal';
    ballScore = 1;
  }
  
  ball.classList.add(ballType);
  ball.style.left = `${rect.left + rect.width / 2 - 20}px`;
  ball.style.top = `${rect.top + rect.height}px`;
  document.body.appendChild(ball);
  
  const ballObj = {
    element: ball,
    x: rect.left + rect.width / 2 - 20,
    y: rect.top + rect.height,
    vx: (Math.random() - 0.5) * 2,
    vy: 0,
    eaten: false,
    hasPlayedSound: false,
    type: ballType,
    score: ballScore
  };
  balls.push(ballObj);
  animateBall(ballObj);
}

function animateBall(ball) {
  const gravity = 0.6;
  const friction = 0.985;
  const tiltForce = 4.5;
  const bounce = 0.5;
  
  function update() {
    if (ball.eaten) return;
    
    ball.vy += gravity;
    ball.vx += tiltX * tiltForce;
    ball.vy += tiltY * tiltForce;
    ball.vx *= friction;
    ball.vy *= friction;
    ball.x += ball.vx;
    ball.y += ball.vy;
    
    if (ball.y >= groundY) {
      ball.y = groundY;
      ball.vy = -ball.vy * bounce;
      ball.vx *= 0.85;
      
      if (Math.abs(ball.vy) < 1) {
        ball.vy = 0;
      }
      
      if (!ball.hasPlayedSound && Math.abs(ball.vy) > 0.5) {
        AudioManager.playSound('ballDrop');
        ball.hasPlayedSound = true;
      }
    }
    
    if (ball.x < 0) {
      ball.x = 0;
      ball.vx = -ball.vx * 0.5;
    }
    if (ball.x > innerWidth - 40) {
      ball.x = innerWidth - 40;
      ball.vx = -ball.vx * 0.5;
    }
    
    ball.element.style.left = `${ball.x}px`;
    ball.element.style.top = `${ball.y}px`;
    
    checkUCollection(ball);
    
    if (!ball.eaten) requestAnimationFrame(update);
  }
  update();
}

function checkUCollection(ball) {
  if (ball.eaten) return;
  
  const uRect = letterU.getBoundingClientRect();
  const ballRect = ball.element.getBoundingClientRect();
  
  const ballCenterX = ballRect.left + ballRect.width / 2;
  const ballCenterY = ballRect.top + ballRect.height / 2;
  
  const uLeft = uRect.left;
  const uRight = uRect.right;
  const uTop = uRect.top + uRect.height * 0.3;
  const uBottom = uRect.bottom;
  
  if (ballCenterX >= uLeft && ballCenterX <= uRight &&
      ballCenterY >= uTop && ballCenterY <= uBottom) {
    
    ball.eaten = true;
    ballsInU.push(ball);
    
    AudioManager.playSound('ballEaten');
    
    const offsetX = (Math.random() - 0.5) * 30;
    const stackY = ballsInU.length * 15;
    
    ball.element.style.transition = 'all 0.3s ease';
    ball.element.style.left = `${uRect.left + uRect.width / 2 - 20 + offsetX}px`;
    ball.element.style.top = `${uRect.bottom - stackY - 40}px`;
    
    currentScore += ball.score;
    totalBalls++;
    scoreDisplay.textContent = currentScore;
    ballCountDisplay.textContent = `(${totalBalls}/${TARGET_SCORE})`;
    
    if (totalBalls >= TARGET_SCORE) {
      setTimeout(tiltUAndShowReward, 1000);
    }
  }
}

function tiltUAndShowReward() {
  clearInterval(walkTimer);
  dot.style.display = "none";
  balls.forEach(b => b.element && b.element.remove());
  balls = [];
  
  AudioManager.playSound('success');
  
  letterU.classList.add('tilting');
  
  setTimeout(() => {
    ballsInU.forEach((ball, index) => {
      setTimeout(() => {
        const giftRect = giftBtn.getBoundingClientRect();
        ball.element.style.transition = 'all 0.5s ease';
        ball.element.style.left = `${giftRect.left + giftRect.width / 2 - 20}px`;
        ball.element.style.top = `${giftRect.top + giftRect.height / 2 - 20}px`;
        ball.element.style.transform = 'scale(0)';
        
        setTimeout(() => ball.element.remove(), 500);
      }, index * 100);
    });
  }, 500);
  
  setTimeout(() => {
    giftBtn.classList.add('satisfied');
  }, 2000);
  
  setTimeout(() => {
    fireworkBurst(centerX, centerY);
    AudioManager.playSound('promoAppear');
  }, 2500);
  
  setTimeout(() => {
    promoCard.classList.add('show');
  }, 4000);
}

function fireworkBurst(x, y) {
  const particles = [];
  const colors = ['#FF3B3F', '#FFD700', '#32CD32', '#1E90FF', '#FF69B4', '#FFA500'];
  
  for (let i = 0; i < 100; i++) {
    const angle = Math.random() * 2 * Math.PI;
    const speed = 2 + Math.random() * 5;
    const size = 2 + Math.random() * 4;
    particles.push({
      x, y,
      dx: Math.cos(angle) * speed,
      dy: Math.sin(angle) * speed,
      color: colors[Math.floor(Math.random() * colors.length)],
      size,
      alpha: 1
    });
  }
  
  let frames = 0;
  function animate() {
    frames++;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => {
      p.x += p.dx;
      p.y += p.dy;
      p.dy += 0.08;
      p.alpha *= 0.97;
      const c = parseInt(p.color.slice(1), 16);
      const rgb = `${(c >> 16) & 255}, ${(c >> 8) & 255}, ${c & 255}`;
      ctx.fillStyle = `rgba(${rgb}, ${p.alpha})`;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, 2 * Math.PI);
      ctx.fill();
    });
    if (frames < 60) requestAnimationFrame(animate);
    else ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  animate();
}

promoCard.onclick = () => {
  promoCard.classList.remove('show');
  setTimeout(() => {
    currentScore = 0;
    totalBalls = 0;
    ballsInU = [];
    scoreDisplay.textContent = '0';
    ballCountDisplay.textContent = '(0/20)';
    letterU.classList.remove('tilting');
    giftBtn.classList.remove('satisfied');
    dot.style.display = 'flex';
    dot.style.left = `${centerX - 30}px`;
    dot.style.top = `${centerY - 30}px`;
    startRandomWalk();
  }, 300);
};

function playLogoSound() {
  AudioManager.playSound('logoClick');
}

// ========== Èü≥‰πêÊéßÂà∂ ==========
let isMusicMuted = false;

function loadMusicState() {
  try {
    const saved = localStorage.getItem('musicMuted');
    if (saved !== null) {
      isMusicMuted = saved === 'true';
      updateMusicButton();
      if (isMusicMuted) {
        AudioManager.stopBGM();
      }
    }
  } catch (e) {
    console.log('Êó†Ê≥ïËØªÂèñÈü≥‰πêÁä∂ÊÄÅ');
  }
}

function saveMusicState() {
  try {
    localStorage.setItem('musicMuted', isMusicMuted.toString());
  } catch (e) {
    console.log('Êó†Ê≥ï‰øùÂ≠òÈü≥‰πêÁä∂ÊÄÅ');
  }
}

function updateMusicButton() {
  const button = document.getElementById('musicToggle');
  const icon = document.getElementById('musicIcon');
  if (button && icon) {
    if (isMusicMuted) {
      icon.textContent = 'üîá';
      button.classList.add('muted');
      button.title = 'ÁÇπÂáªÂºÄÂêØÈü≥‰πê';
    } else {
      icon.textContent = 'üîä';
      button.classList.remove('muted');
      button.title = 'ÁÇπÂáªÂÖ≥Èó≠Èü≥‰πê';
    }
  }
}

function toggleMusic() {
  isMusicMuted = !isMusicMuted;
  
  if (isMusicMuted) {
    AudioManager.stopBGM();
  } else {
    AudioManager.playBGM();
  }
  
  updateMusicButton();
  saveMusicState();
}

window.addEventListener('DOMContentLoaded', () => {
  loadMusicState();
});

document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    AudioManager.stopAllAudio();
  }
});

function switchLanguage(lang) {
  currentLanguage = lang;
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.lang === lang);
  });
  AudioManager.loadVoices(lang);
  updateTexts();
  localStorage.setItem('preferredLanguage', lang);
  updateClock();
}

function updateTexts() {
  if (typeof ASSETS === 'undefined' || !ASSETS.languages || !ASSETS.languages[currentLanguage]) {
    return;
  }
  
  const texts = ASSETS.languages[currentLanguage];
  
  document.getElementById('btnBook').textContent = texts.buttonBook;
  document.getElementById('btnGiftFull').textContent = texts.buttonGift;
  document.getElementById('btnServices').textContent = texts.buttonServices;
  document.getElementById('btnMember').textContent = texts.buttonMember;
}

function updateClock() {
  const now = new Date();
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  const timeString = `${hours}:${minutes}:${seconds}`;
  
  const panelClockTimeInline = document.getElementById('panelClockTimeInline');
  const panelClockDateInline = document.getElementById('panelClockDateInline');
  
  if (panelClockTimeInline && panelClockDateInline) {
    panelClockTimeInline.textContent = timeString;
    
    const month = now.getMonth() + 1;
    const date = now.getDate();
    const weekdays = ['Âë®Êó•', 'Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î', 'Âë®ÂÖ≠'];
    const weekday = weekdays[now.getDay()];
    
    if (currentLanguage === 'zh') {
      panelClockDateInline.textContent = `${month}Êúà${date}Êó• ${weekday}`;
    } else if (currentLanguage === 'en') {
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const weekdaysEn = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      panelClockDateInline.textContent = `${monthNames[month-1]} ${date}, ${weekdaysEn[now.getDay()]}`;
    } else if (currentLanguage === 'es') {
      const monthNamesEs = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
      const weekdaysEs = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
      panelClockDateInline.textContent = `${date} ${monthNamesEs[month-1]}, ${weekdaysEs[now.getDay()]}`;
    }
  }
}

setInterval(updateClock, 1000);

const panelContents = {
  zh: {
    book: {
      title: 'üìÖ Âú®Á∫øÈ¢ÑÁ∫¶',
      sections: [
        {
          title: 'üíÖ MANICURE',
          features: [
            'Regular Mani---------$12',
            'Color Gel Mani-------$30',
            'Powder Gel Mani------$45'
          ]
        },
        {
          title: 'ü¶∂ PEDICURE',
          features: [
            'Regular Pedi---------$22',
            'Color Gel Pedi-------$40'
          ]
        },
        {
          title: 'üìû ËÅîÁ≥ªÊñπÂºè',
          features: [
            'üì± (516) 371-4557',
            'üí¨ (917) 330-5781',
            'üìç 97 Doughty Blvd Inwood NY 11096',
            '‚è∞ Âë®‰∫åËá≥Âë®Êó• 9:58-18:58'
          ]
        }
      ],
      action: 'Á´ãÂç≥È¢ÑÁ∫¶'
    },
    services: {
      title: 'üíÖ ÊúçÂä°È°πÁõÆ',
      sections: [{
        title: '‰∏ì‰∏öÊúçÂä°',
        features: ['Êü•ÁúãÂÆåÊï¥‰ª∑ÁõÆË°®']
      }],
      action: '‰∫ÜËß£ËØ¶ÊÉÖ'
    },
    member: {
      title: 'üëë ‰ºöÂëò‰∏≠ÂøÉ',
      sections: [{
        title: '‰ºöÂëòÁ¶èÂà©',
        features: ['‰∫´Âèó‰∏ìÂ±û‰ºòÊÉ†']
      }],
      action: 'Âä†ÂÖ•‰ºöÂëò'
    }
  },
  en: {
    book: {
      title: 'üìÖ Book',
      sections: [
        {
          title: 'üíÖ MANICURE',
          features: [
            'Regular Mani---------$12',
            'Color Gel Mani-------$30',
            'Powder Gel Mani------$45'
          ]
        },
        {
          title: 'ü¶∂ PEDICURE',
          features: [
            'Regular Pedi---------$22',
            'Color Gel Pedi-------$40'
          ]
        },
        {
          title: 'üìû Contact',
          features: [
            'üì± (516) 371-4557',
            'üí¨ (917) 330-5781',
            'üìç 97 Doughty Blvd Inwood NY 11096',
            '‚è∞ Tue-Sun 9:58-18:58'
          ]
        }
      ],
      action: 'Book Now'
    },
    services: {
      title: 'üíÖ Services',
      sections: [{
        title: 'Professional',
        features: ['View menu']
      }],
      action: 'Learn More'
    },
    member: {
      title: 'üëë Membership',
      sections: [{
        title: 'Benefits',
        features: ['Exclusive discounts']
      }],
      action: 'Join'
    }
  },
  es: {
    book: {
      title: 'üìÖ Reservar',
      sections: [
        {
          title: 'üíÖ MANICURE',
          features: [
            'Regular Mani---------$12',
            'Color Gel Mani-------$30',
            'Powder Gel Mani------$45'
          ]
        },
        {
          title: 'ü¶∂ PEDICURE',
          features: [
            'Regular Pedi---------$22',
            'Color Gel Pedi-------$40'
          ]
        },
        {
          title: 'üìû Contacto',
          features: [
            'üì± (516) 371-4557',
            'üí¨ (917) 330-5781',
            'üìç 97 Doughty Blvd Inwood NY 11096',
            '‚è∞ Mar-Dom 9:58-18:58'
          ]
        }
      ],
      action: 'Reservar'
    },
    services: {
      title: 'üíÖ Servicios',
      sections: [{
        title: 'Profesional',
        features: ['Ver men√∫']
      }],
      action: 'M√°s'
    },
    member: {
      title: 'üëë Membres√≠a',
      sections: [{
        title: 'Beneficios',
        features: ['Descuentos']
      }],
      action: '√önete'
    }
  }
};

function openFunctionPanel(type) {
  const panel = document.getElementById('functionPanel');
  const overlay = document.getElementById('panelOverlay');
  const title = document.getElementById('panelTitle');
  const contentArea = document.getElementById('panelContentArea');
  
  AudioManager.playSound('panelSlide');
  
  const content = panelContents[currentLanguage][type];
  
  if (type === 'book') {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    const month = now.getMonth() + 1;
    const date = now.getDate();
    const weekdays = ['Âë®Êó•', 'Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î', 'Âë®ÂÖ≠'];
    const weekday = weekdays[now.getDay()];
    
    const titleText = content.title;
    const timeStr = `${hours}:${minutes}:${seconds}`;
    const dateStr = `${month}Êúà${date}Êó• ${weekday}`;
    
    if (currentLanguage === 'zh') {
      title.innerHTML = `
        <div class="panel-title-container">
          <div class="panel-title-text">${titleText}</div>
          <div class="panel-title-clock">
            <div class="panel-clock-time-inline" id="panelClockTimeInline">${timeStr}</div>
            <div class="panel-clock-date-inline" id="panelClockDateInline">${dateStr}</div>
          </div>
        </div>
      `;
    } else if (currentLanguage === 'en') {
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const weekdaysEn = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      title.innerHTML = `
        <div class="panel-title-container">
          <div class="panel-title-text">${titleText}</div>
          <div class="panel-title-clock">
            <div class="panel-clock-time-inline" id="panelClockTimeInline">${timeStr}</div>
            <div class="panel-clock-date-inline" id="panelClockDateInline">${monthNames[month-1]} ${date}, ${weekdaysEn[now.getDay()]}</div>
          </div>
        </div>
      `;
    } else {
      const monthNamesEs = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
      const weekdaysEs = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
      title.innerHTML = `
        <div class="panel-title-container">
          <div class="panel-title-text">${titleText}</div>
          <div class="panel-title-clock">
            <div class="panel-clock-time-inline" id="panelClockTimeInline">${timeStr}</div>
            <div class="panel-clock-date-inline" id="panelClockDateInline">${date} ${monthNamesEs[month-1]}, ${weekdaysEs[now.getDay()]}</div>
          </div>
        </div>
      `;
    }
  } else {
    title.textContent = content.title;
  }
  
  let html = '';
  content.sections.forEach(section => {
    html += `<div class="content-section">`;
    html += `<div class="section-title">${section.title}</div>`;
    if (section.text) html += `<div class="section-text">${section.text}</div>`;
    if (section.features) {
      html += `<ul class="feature-list">`;
      section.features.forEach(f => {
        html += `<li class="feature-item">${f}</li>`;
      });
      html += `</ul>`;
    }
    html += `</div>`;
  });
  
  html += `<button class="action-button">${content.action}</button>`;
  contentArea.innerHTML = html;
  
  overlay.classList.add('show');
  panel.classList.add('show');
  
  if (type === 'book') {
    updateClock();
  }
}

function closeFunctionPanel() {
  document.getElementById('functionPanel').classList.remove('show');
  document.getElementById('panelOverlay').classList.remove('show');
}

function clickButton(type) {
  AudioManager.playVoice('button' + type.charAt(0).toUpperCase() + type.slice(1));
  setTimeout(() => openFunctionPanel(type), 100);
}

window.addEventListener('resize', () => {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
});
</script>
</body>
</html>